{% extends 'base.html' %}

{% block title %}Incomes{% endblock %}

{% block footer %}
  <script src="/js/app.js"></script>

  <script>

    $(document).ready(function() {
        
        $('#formAddIncome').validate({
          errorClass: "is-invalid",
          rules: {
              amount: { 
                required: true,
                range: [0.01, 999999.99]
              },
              date_of_income: {
                required: true,
                date: true
              },
              income_category_assigned_to_user_id: {
                required: true,
                validCategory: true
              }
          },
          messages: {
            amount: {
              required: "Podaj kwotę",
              range: "Podaj kwotę z zakresu od 0,01 do 999999,99"
            },
            date_of_income: {
              required: "Podaj datę",
              date: "Niepoprawny format daty dd.mm.rrrr"
            },
            income_category_assigned_to_user_id: {
              required: "Wybierz kategorię"
            }
          }
        });

        setInterval(removeDefaultLabelOnValidateError, 1);
    });

    function removeDefaultLabelOnValidateError() {
      if ($("#floatingInputKwota").hasClass("is-invalid")) {
        $("#floatingInputKwotaLabel").remove();
      } else {
        if (document.getElementById("floatingInputKwotaLabel") === null) {
          $("#floatingInputKwota").after(
            '<label id="floatingInputKwotaLabel" for="floatingInputKwota">Kwota [PLN]</label>'
          );
        }
      }

      if ($("#floatingSelect").hasClass("is-invalid")) {
        $("#floatingSelectLabel").remove();
      } else {
        if (document.getElementById("floatingSelectLabel") === null) {
          $("#floatingSelect").after(
            '<label id="floatingSelectLabel" for="floatingSelect">Wybierz kategorię</label>'
          );
        }
      }

      if ($("#floatingDate").hasClass("is-invalid")) {
        $("#floatingDateLabel").remove();
      } else {
        if (document.getElementById("floatingDateLabel") === null) {
          $("#floatingDate").after(
            '<label id="floatingDateLabel" for="floatingDate">Data</label>'
          );
        }
      }
    }
  </script>

{% endblock %}

{% block body %}

<main class="container">
    <div class="bg-light px-5 py-4 rounded">
      <!-- <h1 class="h3 mb-4 center-block">Wprowadź dane:</h1> -->
      <form method="post" action="/Incomes/add" id="formAddIncome">

        {% if income.errors is not empty %}
          <div class="form-floating mb-2 center-block">
            <ul>
                {% for error in income.errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            </ul>
          </div>
        {% endif %}

        <!-- JS use class is-invalid when input validation -->
        <div class="form-floating mb-2 center-block">
          <input
            type="number"
            class="form-control input-width"
            id="floatingInputKwota"
            name="amount"
            placeholder="0,00"
            value="{{ income.amount }}"
            step="0.01"
          />
          <!-- <label for="floatingInputKwota">Kwota [PLN]</label> -->
        </div>

        <!-- JS use class is-invalid when input validation -->
        <div class="form-floating mb-2 center-block">
          <input
            type="date"
            class="form-control input-width"
            id="floatingDate"
            name="date_of_income"
            placeholder="Data"
            value="{{ income.date_of_income }}"
          />
          <label for="floatingDate">Data</label>
        </div>

        <!-- JS use class is-invalid when input validation -->
        <div class="form-floating mb-2 center-block">
          <select class="form-select input-width" 
          id="floatingSelect"
          name="income_category_assigned_to_user_id"
          >
            <option>wybierz</option>
            {% for category in income_categories %}
              <option value="{{ category.id }}"
              {{ (category.id==income.income_category_assigned_to_user_id) ? 'selected' }}>
                  {{ category.name }}
              </option>
            {% endfor %}
          </select>
          <!-- <label for="floatingSelect">Kategoria</label> -->
        </div>

        <div class="form-floating mb-2 center-block">
          <textarea
            class="form-control input-width"
            placeholder="Komentarz"
            id="floatingTextarea"
            name="income_comment"
          >{{ income.income_comment ?? '' }}</textarea>
          <label for="floatingTextarea">Komentarz</label>
        </div>

        <button class="w-100 btn btn-lg rounded-3 btn-success input-width center-block" type="submit">
          Dodaj
        </button>
      </form>
    </div>
</main>

{% endblock %}
