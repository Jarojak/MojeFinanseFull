{% extends 'base.html' %}

{% block title %}Bilans{% endblock %}

{% block link %}
  <link href="/fontello/css/fontello.css" rel="stylesheet" />
{% endblock %}


{% block modal %}
    <a class="dropdown-item" href="#modalDateSelector" data-bs-toggle="modal">Wybrany zakres dat</a>
{% endblock %}

{% block footer %}
    <script src="https://www.gstatic.com/charts/loader.js"></script>

    <script src="/js/app.js"></script>

    <script>

      let tr = null;
      let expenses_categories_sum_table = [["Wydatki", "Wartość"]];
      let incomes_categories_sum_table = [["Przychody", "Wartość"]];
      let chart_expenses = null;
      let chart_incomes = null;
      let chart_data_expenses = null;
      let chart_data_incomes = null;
      let chart_options_expenses = null;
      let chart_options_incomes = null;

      google.charts.load("current", { packages: ["corechart"] });

      google.charts.setOnLoadCallback(drawChartIncomes);
      google.charts.setOnLoadCallback(drawChartExpenses);

      function drawChartIncomes() {
        chart_data_incomes = google.visualization.arrayToDataTable(incomes_categories_sum_table);

        chart_options_incomes = {
          title: "Przychody",
          titleTextStyle: {
            // color: <string>,    // any HTML string color ('red', '#cc00cc')
            // fontName: <string>, // i.e. 'Times New Roman'
            fontSize: 18, // 12, 18 whatever you want (don't specify px)
            // bold: <boolean>,    // true or false
            // italic: <boolean>   // true of false
          },
          pieHole: 0.3,
          legend: "none",
          backgroundColor: "transparent",
          width: 400,
          height: 400,
        };

        chart_incomes = new google.visualization.PieChart(
          document.getElementById("incomesDonutChart")
        );
        //chart_incomes.draw(chart_data_incomes, chart_options_incomes); //draw graphs on load
      }

      function drawChartExpenses() {
        chart_data_expenses = google.visualization.arrayToDataTable(expenses_categories_sum_table);

        chart_options_expenses = {
          title: "Wydatki",
          titleTextStyle: {
            // color: <string>,    // any HTML string color ('red', '#cc00cc')
            // fontName: <string>, // i.e. 'Times New Roman'
            fontSize: 18, // 12, 18 whatever you want (don't specify px)
            // bold: <boolean>,    // true or false
            // italic: <boolean>   // true of false
          },
          pieHole: 0.3,
          legend: "none",
          backgroundColor: "transparent",
          width: 400,
          height: 400,
        };

        chart_expenses = new google.visualization.PieChart(
          document.getElementById("expensesDonutChart")
        );
        //chart_expenses.draw(chart_data_expenses, chart_options_expenses); //darw graph on load
      }

      function dontSubmit() {
        //return false;
      }

      function setSelectByText(eID,text)
      {
        let ele=document.getElementById(eID);
        for(let ii=0; ii<ele.length; ii++)
          if(ele.options[ii].text==text) {
            ele.options[ii].selected=true;
            return true;
          }
        return false;
      }

      function updateBalanceData(data)
      {
        const balance = data.incomes_sum.amount_sum - data.expenses_sum.amount_sum;
        const balanceElement = document.getElementById("updateBalanceData");
        balanceElement.textContent = parseFloat(balance).toFixed(2);
        if (balance > 0) {
          balanceElement.classList.add("balance_plus");
          balanceElement.classList.remove("balance_minus");
        } else {
          balanceElement.classList.remove("balance_plus");
          balanceElement.classList.add("balance_minus");
        }
      }

      const updateGraphsData = async () => {

        const date_start = document.getElementById("balanceDateStart").textContent;
        const date_end = document.getElementById("balanceDateEnd").textContent;

        const inData = {
          date_start: date_start,
          date_end: date_end
        };

        try { 
          const res = await fetch(`/Balance/getIncomesAndExpensesSumGroupedByCategory`, {
              method: 'post',
              body: JSON.stringify(inData)
          })
          const data = await res.json();

          incomes_categories_sum_table = [["Przychody", "Wartość"]];
          for(let i=0; i < data.incomes_category_sum.length; i++) {
            incomes_categories_sum_table.push([data.incomes_category_sum[i].category_name, parseFloat(data.incomes_category_sum[i].category_amount_sum)]);
          }
          chart_data_incomes = google.visualization.arrayToDataTable(incomes_categories_sum_table);
          chart_incomes.draw(chart_data_incomes, chart_options_incomes);

          expenses_categories_sum_table = [["Wydatki", "Wartość"]];
          for(let i=0; i < data.expenses_category_sum.length; i++) {
            expenses_categories_sum_table.push([data.expenses_category_sum[i].category_name, parseFloat(data.expenses_category_sum[i].category_amount_sum)]);
          }
          chart_data_expenses = google.visualization.arrayToDataTable(expenses_categories_sum_table);
          chart_expenses.draw(chart_data_expenses, chart_options_expenses);
        } catch (e) {
            console.log('ERROR: ', e);
        }
      
      }

      document.onreadystatechange = () => {
        if (document.readyState === 'interactive') {
            window.addEventListener('load', function () {
              updateGraphsData();
            })

          // Edit Expense 
          document.getElementById("tableExpenses")
          .querySelector("a.editingTRbutton")
          .addEventListener('click', function(ele) {

              tr = ele.target.parentNode.parentNode.parentNode;

              let id = tr.cells[1].textContent;
              let date = tr.cells[2].textContent;
              let category = tr.cells[3].textContent;
              let method = tr.cells[4].textContent;
              let comment = tr.cells[5].textContent;
              let amount = tr.cells[6].textContent;

              document.getElementById("editExpenseId").value = id;
              document.getElementById("editExpenseAmount").value = amount;
              document.getElementById("editExpenseDate").value = date;
              document.getElementById("editExpenseComment").value = comment;
              setSelectByText('editExpenseCategory', category);
              setSelectByText('editExpenseMethod', method);

          });

          document.querySelector("button.button-expense-change")
          .addEventListener('click', async () => {

            let id = document.getElementById("editExpenseId").value;
            let amount = document.getElementById("editExpenseAmount").value;
            let date_of_expense = document.getElementById("editExpenseDate").value;
            let expense_category_assigned_to_user_id = document.getElementById("editExpenseCategory").value;
            let payment_method_assigned_to_user_id = document.getElementById("editExpenseMethod").value;
            let expense_comment = document.getElementById("editExpenseComment").value;
            let date_start = document.getElementById("balanceDateStart").textContent;
            let date_end = document.getElementById("balanceDateEnd").textContent;

            const inData = {
              id: id,
              amount: amount,
              date_of_expense: date_of_expense,
              expense_category_assigned_to_user_id: expense_category_assigned_to_user_id,
              payment_method_assigned_to_user_id: payment_method_assigned_to_user_id,
              expense_comment: expense_comment,
              date_start: date_start,
              date_end: date_end
            };

            try { 
              const res = await fetch(`/Expenses/updateTableRowAjax`, {
                  method: 'post',
                  body: JSON.stringify(inData)
              })
              const data = await res.json();
              if (data.success == false) {
                alert(data.errors);
              } else {
                tr.cells[1].textContent = id;
                tr.cells[2].textContent = date_of_expense;
                const categorySelect = document.getElementById("editExpenseCategory");
                tr.cells[3].textContent = categorySelect.options[categorySelect.selectedIndex].text;
                const methodSelect = document.getElementById("editExpenseMethod");
                tr.cells[4].textContent = methodSelect.options[methodSelect.selectedIndex].text;
                tr.cells[5].textContent = expense_comment;
                tr.cells[6].textContent = parseFloat(amount).toFixed(2);
                
                updateBalanceData(data);
                updateGraphsData();
              }
            } catch (e) {
              console.log('ERROR: ', e);
            }

          });

          // Edit Income
          $("#tableIncomes").on("click", "a.editingTRbutton", function(ele) {

              //table row text data
              tr = ele.target.parentNode.parentNode.parentNode;

              let id = tr.cells[1].textContent;
              let date = tr.cells[2].textContent;
              let category = tr.cells[3].textContent;
              let comment = tr.cells[4].textContent;
              let amount = tr.cells[5].textContent;

              //Prefill the fields with the gathered information
              $('#editIncomeId').val(id);
              $('#editIncomeAmount').val(amount);
              $('#editIncomeDate').val(date);
              $('#editIncomeComment').val(comment);
              setSelectByText('editIncomeCategory', category);

            });

          $("button.button-income-change").on("click", function(e) {

            let id = $("#editIncomeId").val();
            let amount = $("#editIncomeAmount").val();
            let date_of_income = $("#editIncomeDate").val();
            let income_category_assigned_to_user_id = $("#editIncomeCategory").val();
            let income_comment = $("#editIncomeComment").val();
            let date_start = $("#balanceDateStart").html();
            let date_end = $("#balanceDateEnd").html();

            $.ajax({
              url: '/Incomes/updateTableRowAjax',
              type: 'POST',
              data: {id: id,
                    amount: amount,
                    date_of_income: date_of_income,
                    income_category_assigned_to_user_id: income_category_assigned_to_user_id,
                    income_comment: income_comment,
                    date_start: date_start,
                    date_end: date_end
            }
            })
            .done(function(inData) {
              let data = $.parseJSON(inData);
              if (data.success == false) {
                alert(data.errors);
              } else {
                tr.cells[1].textContent = id;
                tr.cells[2].textContent = date_of_income;
                tr.cells[3].textContent = $("#editIncomeCategory option:selected").text();
                tr.cells[4].textContent = income_comment;
                tr.cells[5].textContent = parseFloat(amount).toFixed(2);

                updateBalanceData(data);
                updateGraphsData();
              }
            });
          });

          // Remove Expense
          $("#tableExpenses").on("click", "a.removingTRbutton", function(ele) {

            //table row text data
            tr = ele.target.parentNode.parentNode.parentNode;

            let id = tr.cells[1].textContent;
            let date = tr.cells[2].textContent;
            let category = tr.cells[3].textContent;
            let method = tr.cells[4].textContent;
            let comment = tr.cells[5].textContent;
            let amount = tr.cells[6].textContent;

            // fill invisible input in modal
            $('#removeExpenseId').val(id);

            // display record in modal
            $("#expenseRowToRemove").html("data: " + date 
                                          + "</br>kategoria: " + category
                                          + "</br>metada płatności: " + method
                                          + "</br>opis: " + comment
                                          + "</br>kwota: " + amount);

          });

          $("button.button-expense-remove").on("click", function(e) {

            let id = $("#removeExpenseId").val();
            let date_start = $("#balanceDateStart").html();
            let date_end = $("#balanceDateEnd").html();

            $.ajax({
              url: '/Expenses/removeTableRowAjax',
              type: 'POST',
              data: {id: id,
                    date_start: date_start,
                    date_end: date_end
              }
            })
            .done(function(inData) {
              // remove table row
              tr.remove();
              // renumber index
              let index = 1;
              $("tr.expense-item-in-expenses-table").each(function() {
                $(this)[0].cells[0].textContent = index;
                index++;
              });
              // redisplay balance value
              let data = $.parseJSON(data);
              updateBalanceData(data);
              updateGraphsData();
            });
          });

          // Remove Income
          $("#tableIncomes").on("click", "a.removingTRbutton", function(ele) {

            //table row text data
            tr = ele.target.parentNode.parentNode.parentNode;

            let id = tr.cells[1].textContent;
            let date = tr.cells[2].textContent;
            let category = tr.cells[3].textContent;
            let comment = tr.cells[5].textContent;
            let amount = tr.cells[6].textContent;

            // fill invisible input in modal
            $('#removeIncomeId').val(id);

            // display record in modal
            $("#incomeRowToRemove").html("data: " + date 
                                          + "</br>kategoria: " + category
                                          + "</br>opis: " + comment
                                          + "</br>kwota: " + amount);

          });

          $("button.button-income-remove").on("click", function(e) {

          let id = $("#removeIncomeId").val();
          let date_start = $("#balanceDateStart").html();
          let date_end = $("#balanceDateEnd").html();

          $.ajax({
            url: '/Incomes/removeTableRowAjax',
            type: 'POST',
            data: {id: id,
                  date_start: date_start,
                  date_end: date_end
            }
          })
          .done(function(inData) {
            // remove table row
            tr.remove();
            // renumber index
            let index = 1;
            $("tr.income-item-in-incomes-table").each(function() {
              $(this)[0].cells[0].textContent = index;
              index++;
            });
            // redisplay balance value
            let data = $.parseJSON(inData);
            updateBalanceData(data);
            updateGraphsData();
          });
        });

          $('#formEditIncome').validate({
            errorClass: "is-invalid",
            rules: {
                amount: { 
                  required: true,
                  range: [0.01, 999999.99]
                },
                date_of_income: {
                  required: true,
                  date: true
                },
                income_category_assigned_to_user_id: {
                  required: true,
                  validCategory: true
                }
            },
            messages: {
              amount: {
                required: "Podaj kwotę",
                range: "Podaj kwotę z zakresu od 0,01 do 999999,99"
              },
              date_of_income: {
                required: "Podaj datę",
                date: "Niepoprawny format daty dd.mm.rrrr"
              },
              income_category_assigned_to_user_id: {
                required: "Wybierz kategorię"
              }
            },
            submitHandler: function(form) {
              $('#modalEditIncome').modal('toggle');
            }
          });

          $('#formEditExpense').validate({
            errorClass: "is-invalid",
            rules: {
                amount: { 
                  required: true,
                  range: [0.01, 999999.99]
                },
                date_of_expense: {
                  required: true,
                  date: true
                },
                expense_category_assigned_to_user_id: {
                  required: true,
                  validCategory: true
                },
                payment_method_assigned_to_user_id: {
                  required: true,
                  validCategory: true
                }
            },
            messages: {
              amount: {
                required: "Podaj kwotę",
                range: "Podaj kwotę z zakresu od 0,01 do 999999,99"
              },
              date_of_expense: {
                required: "Podaj datę",
                date: "Niepoprawny format daty dd.mm.rrrr"
              },
              expense_category_assigned_to_user_id: {
                required: "Wybierz kategorię"
              },
              payment_method_assigned_to_user_id: {
                required: "Wybierz metodę płatności",
                validCategory: "Wybierz metodę płatności"
              }
            },
            submitHandler: function(form) {
              $('#modalEditExpense').modal('toggle');
            }
          });

          setInterval(removeDefaultLabelOnValidateError, 1);

          function removeDefaultLabelOnValidateError() {
            if ($("#editIncomeAmount").hasClass("is-invalid")) {
              $("#editIncomeAmountLabel").remove();
            } else {
              if (document.getElementById("editIncomeAmountLabel") === null) {
                $("#editIncomeAmount").after(
                  '<label id="editIncomeAmountLabel" for="editIncomeAmount">Kwota [PLN]</label>'
                );
              }
            }

            if ($("#editIncomeCategory").hasClass("is-invalid")) {
              $("#editIncomeCategoryLabel").remove();
            } else {
              if (document.getElementById("editIncomeCategoryLabel") === null) {
                $("#editIncomeCategory").after(
                  '<label id="editIncomeCategoryLabel" for="editIncomeCategory">Wybierz kategorię</label>'
                );
              }
            }

            if ($("#editIncomeDate").hasClass("is-invalid")) {
              $("#editIncomeDateLabel").remove();
            } else {
              if (document.getElementById("editIncomeDateLabel") === null) {
                $("#editIncomeDate").after(
                  '<label id="editIncomeDateLabel" for="editIncomeDate">Data</label>'
                );
              }
            }

            if ($("#editExpenseAmount").hasClass("is-invalid")) {
              $("#editExpenseAmountLabel").remove();
            } else {
              if (document.getElementById("editExpenseAmountLabel") === null) {
                $("#editExpenseAmount").after(
                  '<label id="editExpenseAmountLabel" for="editExpenseAmount">Kwota [PLN]</label>'
                );
              }
            }

            if ($("#editExpenseCategory").hasClass("is-invalid")) {
              $("#editExpenseCategoryLabel").remove();
            } else {
              if (document.getElementById("editExpenseCategoryLabel") === null) {
                $("#editExpenseCategory").after(
                  '<label id="editExpenseCategoryLabel" for="editExpenseCategory">Wybierz kategorię</label>'
                );
              }
            }

            if ($("#editExpenseMethod").hasClass("is-invalid")) {
              $("#editExpenseMethodLabel").remove();
            } else {
              if (document.getElementById("editExpenseMethodLabel") === null) {
                $("#editExpenseMethod").after(
                  '<label id="editExpenseMethodLabel" for="editExpenseMethod">Data</label>'
                );
              }
            }

            if ($("#editExpenseDate").hasClass("is-invalid")) {
              $("#editExpenseDateLabel").remove();
            } else {
              if (document.getElementById("editExpenseDateLabel") === null) {
                $("#editExpenseDate").after(
                  '<label id="editExpenseDateLabel" for="editExpenseDate">Data</label>'
                );
              }
            }
          }
        
        }
      }

    </script>

{% endblock %}

{% block body %}
    <main class="container">
        <div class="bg-light px-5 py-4 mb-5 rounded">
            <div class="row">
                <div class="w-100 text-center bg-dark rounded text-secondary py-3 mt-3">
                    <div class="h3">PODSUMOWANIE</div>
                    <div class="h5">{{ action }}</div>
                    <div class="h5">BILANS:</div>
                    {% set balance_val = balance.incomes_sum.amount_sum - balance.expenses_sum.amount_sum %}
                    <div class="h4 {{ (balance_val >= 0) ? 'balance_plus' : 'balance_minus' }}" id="updateBalanceData">{{ balance_val }}</div>
                    <div hidden id="balanceDateStart">{{ balance.date_start }}</div>
                    <div hidden id="balanceDateEnd">{{ balance.date_end }}</div>
                </div>

                {% if balance.expenses_sum.amount_sum is null and balance.incomes_sum.amount_sum is null %}
                  <div class="h5 w-100 text-center py-3 mt-3">
                    Brak zarejestrowanych transakcji w danym okresie czasu
                  </div>
                {% else %}

                  {% if balance.expenses_sum.amount_sum is null %}
                    <div class="h5 w-100 text-center py-3 mt-3">
                      Brak wydatków w danym okresie czasu
                    </div>
                  {% endif %}

                  {% if balance.incomes_sum.amount_sum is null %}
                    <div class="h5 w-100 text-center py-3 mt-3">
                      Brak przychodów w danym okresie czasu
                    </div>
                  {% endif %}
                {% endif %}

                {% if balance.expenses_sum.amount_sum is null %}
                  <div class="d-flex justify-content-center">
                {% endif %}
                    {% if balance.incomes_sum.amount_sum is not null %}
                      <div class="col-lg-6 d-flex justify-content-center">
                          <div id="incomesDonutChart" class=""></div>
                      </div>
                    {% endif %}
                {% if balance.expenses_sum.amount_sum is null %}
                  </div>
                {% endif %}

                {% if balance.incomes_sum.amount_sum is null %}
                  <div class="d-flex justify-content-center">
                {% endif %}
                    {% if balance.expenses_sum.amount_sum is not null %}
                      <div class="col-lg-6 d-flex justify-content-center">
                          <div id="expensesDonutChart" class=""></div>
                      </div>
                    {% endif %}
                {% if balance.incomes_sum.amount_sum is null %}
                  </div>
                {% endif %}

                <div class="w-100 text-center"></div>

                {% if balance.expenses_sum.amount_sum is null %}
                  <div class="d-flex justify-content-center">
                {% endif %}
                  {% if balance.incomes_sum.amount_sum is not null %}
                    <div class="col-xxl-6 d-flex justify-content-center">
                        <div class="table-responsive">
                            <table class="table caption-top table-success" id="tableIncomes">
                                <caption>
                                    Przychody
                                </caption>
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col" hidden>id</th>
                                        <th scope="col">Data</th>
                                        <th scope="col">Kategoria</th>
                                        <th scope="col">Opis</th>
                                        <th scope="col">Kwota</th>
                                        <th scope="col"></th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for income in balance.incomes %}
                                    <tr class="income-item-in-incomes-table">
                                        <td>{{ loop.index0+1 }}</td>
                                        <td hidden>{{ income.id }}</td>
                                        <td>{{ income.date_of_income }}</td>
                                        <td>{{ income.category_name }}</td>
                                        <td>{{ income.income_comment }}</td>
                                        <td>{{ income.amount }}</td>
                                        <td>
                                          <a class="dropdown-item editingTRbutton" href="#modalEditIncome" data-bs-toggle="modal">
                                            <i class="icon-pencil"></i>
                                          </a>
                                        </td>
                                        <td>
                                          <a class="dropdown-item removingTRbutton" href="#modalRemoveIncome" data-bs-toggle="modal">
                                            <i class="icon-trash"></i>
                                          </a></a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                  {% endif %}
                {% if balance.expenses_sum.amount_sum is null %}
                  </div>
                {% endif %}

                {% if balance.incomes_sum.amount_sum is null %}
                  <div class="d-flex justify-content-center">
                {% endif %}
                  {% if balance.expenses_sum.amount_sum is not null %}
                    <div class="col-xxl-6 d-flex justify-content-center">
                        <div class="table-responsive">
                            <table class="table caption-top table-danger" id="tableExpenses">
                                <caption>
                                    Wydatki
                                </caption>
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col" hidden>id</th>
                                        <th scope="col">Data</th>
                                        <th scope="col">Kategoria</th>
                                        <th scope="col">Forma płatności</th>
                                        <th scope="col">Opis</th>
                                        <th scope="col">Kwota</th>
                                        <th scope="col"></th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for expense in balance.expenses %}
                                    <tr class="expense-item-in-expenses-table">
                                        <td>{{ loop.index0+1 }}</td>
                                        <td hidden>{{ expense.id }}</td>
                                        <td>{{ expense.date_of_expense }}</td>
                                        <td>{{ expense.category_name }}</td>
                                        <td>{{ expense.payment_method_name }}</td>
                                        <td>{{ expense.expense_comment }}</td>
                                        <td>{{ expense.amount }}</td>
                                        <td>
                                          <a class="dropdown-item editingTRbutton" href="#modalEditExpense" data-bs-toggle="modal">
                                            <i class="icon-pencil"></i>
                                          </a>
                                        </td>
                                        <td>
                                          <a class="dropdown-item removingTRbutton" href="#modalRemoveExpense" data-bs-toggle="modal">
                                            <i class="icon-trash"></i>
                                          </a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                  {% endif %}
                {% if balance.incomes_sum.amount_sum is null %}
                  </div>
                {% endif %}

            </div>
        </div>
    </main>

  <!-- MODAL - date selection -->
  <div class="modal fade" id="modalDateSelector" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
              <div class="modal-header p-5 pb-4 border-bottom-0">
              <h1 class="fw-bold mb-0 fs-2">Wybierz zakres dat</h1>
              <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
              ></button>
              </div>

              <div class="modal-body p-5 pt-0">
              <form action="/balance/indexSelectedDates" method="post">
                  <div class="form-floating mb-3">
                  <input
                      type="date"
                      class="form-control rounded-3"
                      name="dateFrom"
                      id="floatingDateFrom"
                      placeholder="Data od"
                  />
                  <label for="floatingDateFrom">Data od</label>
                  </div>
                  <div class="form-floating mb-3">
                  <input
                      type="date"
                      class="form-control rounded-3"
                      name="dateTo"
                      id="floatingDateTo"
                      placeholder="Data do"
                  />
                  <label for="floatingDateTo">Data do</label>
                  </div>
                  <button
                  class="w-100 mb-2 btn btn-lg rounded-3 btn-primary"
                  type="submit"
                  >
                  Zatwierdź
                  </button>
              </form>
              </div>
          </div>
      </div>
  </div>

  <!-- MODAL - edit expense -->
  <div class="modal fade" id="modalEditExpense" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Edycja wydatku</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <form method="post" id="formEditExpense" onsubmit="dontSubmit(); return false;">

          <input type="hidden" name="id" id="editExpenseId"/>

          <!-- JS use class is-invalid when input validation -->
          <div class="modal-body p-5 pt-0">
            <div class="form-floating mb-2 center-block">
              <input
                type="number"
                class="form-control input-width"
                id="editExpenseAmount"
                name="amount"
                placeholder="0.00"
                step="0.01"
              />
              <!-- <label id="editExpenseAmountLabel" for="editExpenseAmount">Kwota [PLN]</label> -->
            </div>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <input
                type="date"
                class="form-control input-width"
                id="editExpenseDate"
                name="date_of_expense"
                placeholder="Data"
                value="{{ expense.date_of_expense }}"
              />
              <!-- <label id="editExpenseDateLabel" for="editExpenseDate">Kwota [PLN]</label> -->
            </div>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <select class="form-select input-width" 
              id="editExpenseCategory"
              name="expense_category_assigned_to_user_id"
              >
                {% for category in balance.expenses_categories %}
                  <option value="{{ category.id }}">
                      {{ category.name }}
                  </option>
                {% endfor %}
              </select>
              <!-- <label id="editExpenseCategory" for="editExpenseCategory">Kwota [PLN]</label> -->
            </div>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <select class="form-select input-width" 
              id="editExpenseMethod"
              name="payment_method_assigned_to_user_id"
              >
                {% for methods in balance.expenses_payment_methods %}
                  <option value="{{ methods.id }}">
                      {{ methods.name }}
                  </option>
                {% endfor %}
              </select>
              <!-- <label id="editExpenseMethodLabel" for="editExpenseMethod">Kwota [PLN]</label> -->
            </div>

            <div class="form-floating mb-2 center-block">
              <textarea
                class="form-control input-width"
                placeholder="Komentarz"
                id="editExpenseComment"
                name="expense_comment"
              >{{ expense.expense_comment ?? '' }}</textarea>
              <label for="editExpenseComment">Komentarz</label>
            </div>

            <button
              class="w-100 mb-2 btn btn-lg rounded-3 btn-warning text-white button-expense-change"
              type="submit"
            >
              Dokonaj zmian
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL - edit income -->
  <div class="modal fade" id="modalEditIncome" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2">Edycja przychodu</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body p-5 pt-0">

          <form method="post" id="formEditIncome" onsubmit="dontSubmit(); return false;">

            <input type="hidden" name="id" id="editIncomeId"/>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <input
                type="number"
                class="form-control input-width"
                id="editIncomeAmount"
                name="amount"
                placeholder="0.00"
                step="0.01"
              />
              <!-- <label id="editIncomeAmountLabel" for="editIncomeAmount">Kwota [PLN]</label> -->
            </div>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <input
                type="date"
                class="form-control input-width"
                id="editIncomeDate"
                name="date_of_income"
                placeholder="Data"
                value="{{ income.date_of_income }}"
              />
              <!-- <label id="editIncomeDateLabel" for="editIncomeDate">Data</label> -->
            </div>

            <!-- JS use class is-invalid when input validation -->
            <div class="form-floating mb-2 center-block">
              <select class="form-select input-width" 
              id="editIncomeCategory"
              name="income_category_assigned_to_user_id"
              >
                {% for category in balance.incomes_categories %}
                  <option value="{{ category.id }}">
                      {{ category.name }}
                  </option>
                {% endfor %}
              </select>
              <!-- <label id="editIncomeCategoryLable" for="editIncomeCategory">Kategoria</label> -->
            </div>

            <div class="form-floating mb-2 center-block">
              <textarea
                class="form-control input-width"
                placeholder="Komentarz"
                id="editIncomeComment"
                name="income_comment"
              >{{ income.income_comment ?? '' }}</textarea>
              <label for="editIncomeComment">Komentarz</label>
            </div>

            <button
              class="w-100 mb-2 btn btn-lg rounded-3 btn-warning text-white button-income-change"
              type="submit"
            >
              Dokonaj zmian
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL - remove expense -->
  <div class="modal fade" id="modalRemoveExpense" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2 w-100">Usuwanie wydatku</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body p-5 pt-0">

          <form method="post" id="formRemoveExpense" onsubmit="dontSubmit(); return false;">

            <input type="hidden" name="id" id="removeExpenseId"/>

            <div class="w-100 my-2 text-center" id="expenseRowToRemove"></div>
            <button
              class="w-100 mb-1 mt-4 btn btn-lg rounded-3 btn-danger button-expense-remove"
              type="button"
              data-bs-dismiss="modal"
            >
              Usuń wydatek
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL - remove income -->
  <div class="modal fade" id="modalRemoveIncome" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header p-5 pb-4 border-bottom-0">
          <h1 class="fw-bold mb-0 fs-2 w-100">Usuwanie wydatku</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
          ></button>
        </div>

        <div class="modal-body p-5 pt-0">

          <form method="post" id="formRemoveIncome" onsubmit="dontSubmit(); return false;">

            <input type="hidden" name="id" id="removeIncomeId"/>

            <div class="w-100 my-2 text-center" id="incomeRowToRemove"></div>
            <button
              class="w-100 mb-1 mt-4 btn btn-lg rounded-3 btn-danger button-income-remove"
              type="button"
              data-bs-dismiss="modal"
            >
              Usuń wydatek
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

{% endblock %}
